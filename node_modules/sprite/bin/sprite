#!/usr/bin/env node

var program = require('commander')
  , Canvas = require('canvas')
  , Image = Canvas.Image
  , fs = require('fs');

/**
 * Options.
 */

program
  .version('0.0.1')
  .usage('[options] <img ...>')
  .option('-p, --pad <px>', 'specify padding defaulting to 0', Number, 0)
  .option('-o, --out <path>', 'specify the output png filename [out.png]', 'out.png')
  .parse(process.argv);

/**
 * Images.
 */

var imgs = program.args;

// required

if (!imgs.length) throw new Error('<img ...> required');

// load images

imgs = imgs.map(function(path){
  var img = new Image;
  img.src = path;
  img.onerror = function(err){
    throw err;
  };
  return img;
});

// reduce width

var width = imgs.reduce(function(sum, img){
  return sum + img.width + program.pad;
}, 0);

// reduce height

var height = imgs.reduce(function(max, img){
  return img.height > max
    ? img.height
    : max;
}, 0);

// draw sprite sheet

var canvas = new Canvas(width, height)
  , ctx = canvas.getContext('2d')
  , x = 0
  , y = 0;

imgs.forEach(function(img){
  ctx.drawImage(img, x, y);
  x += img.width + program.pad;
});

// write

fs.writeFile(program.out, canvas.toBuffer());